{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar _extends = require(\"@babel/runtime/helpers/extends\");\n\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\n\nvar _jsxFileName = \"D:\\\\develop\\\\pypr\\\\HypeFans\\\\mobile_version\\\\node_modules\\\\expo-image-editor\\\\lib\\\\OperationBar\\\\Crop.js\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Crop = void 0;\n\nvar React = __importStar(require(\"react\"));\n\nvar react_native_1 = require(\"react-native-web/dist/index\");\n\nvar recoil_1 = require(\"recoil\");\n\nvar IconButton_1 = require(\"../components/IconButton\");\n\nvar Store_1 = require(\"../Store\");\n\nvar ImageManipulator = __importStar(require(\"expo-image-manipulator\"));\n\nfunction Crop() {\n  var _this = this;\n\n  var _recoil_1$useRecoilSt = recoil_1.useRecoilState(Store_1.accumulatedPanState),\n      _recoil_1$useRecoilSt2 = _slicedToArray(_recoil_1$useRecoilSt, 1),\n      accumulatedPan = _recoil_1$useRecoilSt2[0];\n\n  var _recoil_1$useRecoilSt3 = recoil_1.useRecoilState(Store_1.imageBoundsState),\n      _recoil_1$useRecoilSt4 = _slicedToArray(_recoil_1$useRecoilSt3, 1),\n      imageBounds = _recoil_1$useRecoilSt4[0];\n\n  var _recoil_1$useRecoilSt5 = recoil_1.useRecoilState(Store_1.imageScaleFactorState),\n      _recoil_1$useRecoilSt6 = _slicedToArray(_recoil_1$useRecoilSt5, 1),\n      imageScaleFactor = _recoil_1$useRecoilSt6[0];\n\n  var _recoil_1$useRecoilSt7 = recoil_1.useRecoilState(Store_1.cropSizeState),\n      _recoil_1$useRecoilSt8 = _slicedToArray(_recoil_1$useRecoilSt7, 1),\n      cropSize = _recoil_1$useRecoilSt8[0];\n\n  var _recoil_1$useRecoilSt9 = recoil_1.useRecoilState(Store_1.processingState),\n      _recoil_1$useRecoilSt10 = _slicedToArray(_recoil_1$useRecoilSt9, 2),\n      setProcessing = _recoil_1$useRecoilSt10[1];\n\n  var _recoil_1$useRecoilSt11 = recoil_1.useRecoilState(Store_1.imageDataState),\n      _recoil_1$useRecoilSt12 = _slicedToArray(_recoil_1$useRecoilSt11, 2),\n      imageData = _recoil_1$useRecoilSt12[0],\n      setImageData = _recoil_1$useRecoilSt12[1];\n\n  var _recoil_1$useRecoilSt13 = recoil_1.useRecoilState(Store_1.editingModeState),\n      _recoil_1$useRecoilSt14 = _slicedToArray(_recoil_1$useRecoilSt13, 2),\n      setEditingMode = _recoil_1$useRecoilSt14[1];\n\n  var onPerformCrop = function onPerformCrop() {\n    return __awaiter(_this, void 0, void 0, _regeneratorRuntime.mark(function _callee() {\n      var croppingBounds, cropResult, webCorrection, uri, width, height, _uri, _width, _height;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              croppingBounds = {\n                originX: Math.round((accumulatedPan.x - imageBounds.x) * imageScaleFactor),\n                originY: Math.round((accumulatedPan.y - imageBounds.y) * imageScaleFactor),\n                width: Math.round(cropSize.width * imageScaleFactor),\n                height: Math.round(cropSize.height * imageScaleFactor)\n              };\n              setProcessing(true);\n              _context.next = 4;\n              return ImageManipulator.manipulateAsync(imageData.uri, [{\n                crop: croppingBounds\n              }]);\n\n            case 4:\n              cropResult = _context.sent;\n\n              if (!(react_native_1.Platform.OS == \"web\")) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 8;\n              return ImageManipulator.manipulateAsync(cropResult.uri, [{\n                crop: _extends(_extends({}, croppingBounds), {\n                  originX: 0,\n                  originY: 0\n                })\n              }]);\n\n            case 8:\n              webCorrection = _context.sent;\n              uri = webCorrection.uri, width = webCorrection.width, height = webCorrection.height;\n              setImageData({\n                uri: uri,\n                width: width,\n                height: height\n              });\n              _context.next = 15;\n              break;\n\n            case 13:\n              _uri = cropResult.uri, _width = cropResult.width, _height = cropResult.height;\n              setImageData({\n                uri: _uri,\n                width: _width,\n                height: _height\n              });\n\n            case 15:\n              setProcessing(false);\n              setEditingMode(\"operation-select\");\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n  };\n\n  return React.createElement(react_native_1.View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 13\n    }\n  }, React.createElement(IconButton_1.IconButton, {\n    iconID: \"close\",\n    text: \"Cancel\",\n    onPress: function onPress() {\n      return setEditingMode(\"operation-select\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }\n  }), React.createElement(react_native_1.Text, {\n    style: styles.prompt,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }\n  }, \"Adjust window to crop\"), React.createElement(IconButton_1.IconButton, {\n    iconID: \"check\",\n    text: \"Done\",\n    onPress: function onPress() {\n      return onPerformCrop().catch(function () {\n        setProcessing(false);\n        react_native_1.Alert.alert(\"An error occurred while editing.\");\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }\n  }));\n}\n\nexports.Crop = Crop;\nvar styles = react_native_1.StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: \"2%\"\n  },\n  prompt: {\n    color: \"#fff\",\n    fontSize: 21,\n    textAlign: \"center\"\n  }\n});","map":{"version":3,"sources":["../../src/OperationBar/Crop.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Crop = void 0;\nconst React = __importStar(require(\"react\"));\nconst react_native_1 = require(\"react-native\");\nconst recoil_1 = require(\"recoil\");\nconst IconButton_1 = require(\"../components/IconButton\");\nconst Store_1 = require(\"../Store\");\nconst ImageManipulator = __importStar(require(\"expo-image-manipulator\"));\nfunction Crop() {\n    const [accumulatedPan] = recoil_1.useRecoilState(Store_1.accumulatedPanState);\n    const [imageBounds] = recoil_1.useRecoilState(Store_1.imageBoundsState);\n    const [imageScaleFactor] = recoil_1.useRecoilState(Store_1.imageScaleFactorState);\n    const [cropSize] = recoil_1.useRecoilState(Store_1.cropSizeState);\n    const [, setProcessing] = recoil_1.useRecoilState(Store_1.processingState);\n    const [imageData, setImageData] = recoil_1.useRecoilState(Store_1.imageDataState);\n    const [, setEditingMode] = recoil_1.useRecoilState(Store_1.editingModeState);\n    const onPerformCrop = () => __awaiter(this, void 0, void 0, function* () {\n        // Calculate cropping bounds\n        const croppingBounds = {\n            originX: Math.round((accumulatedPan.x - imageBounds.x) * imageScaleFactor),\n            originY: Math.round((accumulatedPan.y - imageBounds.y) * imageScaleFactor),\n            width: Math.round(cropSize.width * imageScaleFactor),\n            height: Math.round(cropSize.height * imageScaleFactor),\n        };\n        // Set the editor state to processing and perform the crop\n        setProcessing(true);\n        const cropResult = yield ImageManipulator.manipulateAsync(imageData.uri, [\n            { crop: croppingBounds },\n        ]);\n        // Check if on web - currently there is a weird bug where it will keep\n        // the canvas from ImageManipualtor at originX + width and so we'll just crop\n        // the result again for now if on web - TODO write github issue!\n        if (react_native_1.Platform.OS == \"web\") {\n            const webCorrection = yield ImageManipulator.manipulateAsync(cropResult.uri, [{ crop: Object.assign(Object.assign({}, croppingBounds), { originX: 0, originY: 0 }) }]);\n            const { uri, width, height } = webCorrection;\n            setImageData({ uri, width, height });\n        }\n        else {\n            const { uri, width, height } = cropResult;\n            setImageData({ uri, width, height });\n        }\n        setProcessing(false);\n        setEditingMode(\"operation-select\");\n    });\n    return (<react_native_1.View style={styles.container}>\n      <IconButton_1.IconButton iconID=\"close\" text=\"Cancel\" onPress={() => setEditingMode(\"operation-select\")}/>\n      <react_native_1.Text style={styles.prompt}>Adjust window to crop</react_native_1.Text>\n      <IconButton_1.IconButton iconID=\"check\" text=\"Done\" onPress={() => onPerformCrop().catch(() => {\n        // If there's an error dismiss the the editor and alert the user\n        setProcessing(false);\n        react_native_1.Alert.alert(\"An error occurred while editing.\");\n    })}/>\n    </react_native_1.View>);\n}\nexports.Crop = Crop;\nconst styles = react_native_1.StyleSheet.create({\n    container: {\n        flex: 1,\n        flexDirection: \"row\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        paddingHorizontal: \"2%\",\n    },\n    prompt: {\n        color: \"#fff\",\n        fontSize: 21,\n        textAlign: \"center\",\n    },\n});\n//# sourceMappingURL=Crop.js.map"]},"metadata":{},"sourceType":"script"}