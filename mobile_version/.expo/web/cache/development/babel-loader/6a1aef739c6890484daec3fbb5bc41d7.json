{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\n\nvar _jsxFileName = \"D:\\\\develop\\\\pypr\\\\HypeFans\\\\mobile_version\\\\node_modules\\\\expo-image-editor\\\\lib\\\\OperationBar\\\\Rotate.js\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Rotate = void 0;\n\nvar React = __importStar(require(\"react\"));\n\nvar react_native_1 = require(\"react-native-web/dist/index\");\n\nvar recoil_1 = require(\"recoil\");\n\nvar IconButton_1 = require(\"../components/IconButton\");\n\nvar Store_1 = require(\"../Store\");\n\nvar ImageManipulator = __importStar(require(\"expo-image-manipulator\"));\n\nfunction Rotate() {\n  var _this = this;\n\n  var _recoil_1$useRecoilSt = recoil_1.useRecoilState(Store_1.processingState),\n      _recoil_1$useRecoilSt2 = _slicedToArray(_recoil_1$useRecoilSt, 2),\n      setProcessing = _recoil_1$useRecoilSt2[1];\n\n  var _recoil_1$useRecoilSt3 = recoil_1.useRecoilState(Store_1.imageDataState),\n      _recoil_1$useRecoilSt4 = _slicedToArray(_recoil_1$useRecoilSt3, 2),\n      imageData = _recoil_1$useRecoilSt4[0],\n      setImageData = _recoil_1$useRecoilSt4[1];\n\n  var _recoil_1$useRecoilSt5 = recoil_1.useRecoilState(Store_1.editingModeState),\n      _recoil_1$useRecoilSt6 = _slicedToArray(_recoil_1$useRecoilSt5, 2),\n      setEditingMode = _recoil_1$useRecoilSt6[1];\n\n  var _React$useState = React.useState(imageData),\n      _React$useState2 = _slicedToArray(_React$useState, 1),\n      originalImageData = _React$useState2[0];\n\n  var _React$useState3 = React.useState(0),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      rotation = _React$useState4[0],\n      setRotation = _React$useState4[1];\n\n  React.useEffect(function () {\n    if (rotation !== 0) {\n      onRotate(rotation);\n    } else {\n      setImageData(originalImageData);\n    }\n  }, [rotation]);\n\n  var onRotate = function onRotate(angle) {\n    return __awaiter(_this, void 0, void 0, _regeneratorRuntime.mark(function _callee() {\n      var _yield$ImageManipulat, rotateUri, rotateWidth, rotateHeight, _yield$ImageManipulat2, uri, width, height;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setProcessing(true);\n              _context.next = 3;\n              return ImageManipulator.manipulateAsync(originalImageData.uri, [{\n                rotate: angle\n              }]);\n\n            case 3:\n              _yield$ImageManipulat = _context.sent;\n              rotateUri = _yield$ImageManipulat.uri;\n              rotateWidth = _yield$ImageManipulat.width;\n              rotateHeight = _yield$ImageManipulat.height;\n              _context.next = 9;\n              return ImageManipulator.manipulateAsync(rotateUri, [{\n                crop: {\n                  originX: 1,\n                  originY: 1,\n                  width: rotateWidth - 2,\n                  height: rotateHeight - 2\n                }\n              }]);\n\n            case 9:\n              _yield$ImageManipulat2 = _context.sent;\n              uri = _yield$ImageManipulat2.uri;\n              width = _yield$ImageManipulat2.width;\n              height = _yield$ImageManipulat2.height;\n              setImageData({\n                uri: uri,\n                width: width,\n                height: height\n              });\n              setProcessing(false);\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n  };\n\n  var onClose = function onClose() {\n    setImageData(originalImageData);\n    setEditingMode(\"operation-select\");\n  };\n\n  var rotate = function rotate(direction) {\n    var webDirection = react_native_1.Platform.OS === \"web\" ? 1 : -1;\n    var rotateBy = rotation - 90 * webDirection * (direction === \"cw\" ? 1 : -1);\n\n    if (rotateBy > 180) {\n      rotateBy = -90;\n    } else if (rotateBy < -180) {\n      rotateBy = 90;\n    }\n\n    setRotation(rotateBy);\n  };\n\n  return React.createElement(react_native_1.View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 13\n    }\n  }, React.createElement(react_native_1.View, {\n    style: [styles.row, {\n      paddingHorizontal: \"20%\"\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }\n  }, React.createElement(IconButton_1.IconButton, {\n    iconID: \"rotate-left\",\n    text: \"Rotate -90\",\n    onPress: function onPress() {\n      return rotate(\"ccw\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }\n  }), React.createElement(IconButton_1.IconButton, {\n    iconID: \"rotate-right\",\n    text: \"Rotate +90\",\n    onPress: function onPress() {\n      return rotate(\"cw\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  })), React.createElement(react_native_1.View, {\n    style: styles.row,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }, React.createElement(IconButton_1.IconButton, {\n    iconID: \"close\",\n    text: \"Cancel\",\n    onPress: function onPress() {\n      return onClose();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }\n  }), React.createElement(react_native_1.Text, {\n    style: styles.prompt,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }, \"Rotate\"), React.createElement(IconButton_1.IconButton, {\n    iconID: \"check\",\n    text: \"Done\",\n    onPress: function onPress() {\n      return setEditingMode(\"operation-select\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  })));\n}\n\nexports.Rotate = Rotate;\nvar styles = react_native_1.StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: \"column\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\"\n  },\n  prompt: {\n    color: \"#fff\",\n    fontSize: 21,\n    textAlign: \"center\"\n  },\n  row: {\n    width: \"100%\",\n    height: 80,\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: \"2%\"\n  }\n});","map":{"version":3,"sources":["../../src/OperationBar/Rotate.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,KAAA,GAAA,YAAA,CAAA,OAAA,CAAA,OAAA,CAAA,CAAA;;;;AAEA,IAAA,QAAA,GAAA,OAAA,CAAA,QAAA,CAAA;;AACA,IAAA,YAAA,GAAA,OAAA,4BAAA;;AACA,IAAA,OAAA,GAAA,OAAA,YAAA;;AASA,IAAA,gBAAA,GAAA,YAAA,CAAA,OAAA,CAAA,wBAAA,CAAA,CAAA;;AAEA,SAAgB,MAAhB,GAAsB;AAAA;;AAAA,8BAEM,QAAA,CAAA,cAAA,CAAe,OAAA,CAAA,eAAf,CAFN;AAAA;AAAA,MAEX,aAFW;;AAAA,+BAGc,QAAA,CAAA,cAAA,CAAe,OAAA,CAAA,cAAf,CAHd;AAAA;AAAA,MAGb,SAHa;AAAA,MAGF,YAHE;;AAAA,+BAIO,QAAA,CAAA,cAAA,CAAe,OAAA,CAAA,gBAAf,CAJP;AAAA;AAAA,MAIX,cAJW;;AAAA,wBAMQ,KAAK,CAAC,QAAN,CAAe,SAAf,CANR;AAAA;AAAA,MAMb,iBANa;;AAAA,yBAQY,KAAK,CAAC,QAAN,CAAe,CAAf,CARZ;AAAA;AAAA,MAQb,QARa;AAAA,MAQH,WARG;;AAUpB,EAAA,KAAK,CAAC,SAAN,CAAgB,YAAK;AACnB,QAAI,QAAQ,KAAK,CAAjB,EAAoB;AAClB,MAAA,QAAQ,CAAC,QAAD,CAAR;AACD,KAFD,MAEO;AACL,MAAA,YAAY,CAAC,iBAAD,CAAZ;AACD;AACF,GAND,EAMG,CAAC,QAAD,CANH;;AAQA,MAAM,QAAQ,GAAG,SAAX,QAAW,CAAO,KAAP;AAAA,WAAwB,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,2BAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACvC,cAAA,aAAa,CAAC,IAAD,CAAb;AADuC;AASnC,qBAAM,gBAAgB,CAAC,eAAjB,CAAiC,iBAAiB,CAAC,GAAnD,EAAwD,CAChE;AAAE,gBAAA,MAAM,EAAE;AAAV,eADgE,CAAxD,CAAN;;AATmC;AAAA;AAMhC,cAAA,SANgC,yBAMrC,GANqC;AAO9B,cAAA,WAP8B,yBAOrC,KAPqC;AAQ7B,cAAA,YAR6B,yBAQrC,MARqC;AAAA;AAYR,qBAAM,gBAAgB,CAAC,eAAjB,CACnC,SADmC,EAEnC,CACE;AACE,gBAAA,IAAI,EAAE;AACJ,kBAAA,OAAO,EAAE,CADL;AAEJ,kBAAA,OAAO,EAAE,CAFL;AAGJ,kBAAA,KAAK,EAAE,WAAW,GAAG,CAHjB;AAIJ,kBAAA,MAAM,EAAE,YAAY,GAAG;AAJnB;AADR,eADF,CAFmC,CAAN;;AAZQ;AAAA;AAY/B,cAAA,GAZ+B,0BAY/B,GAZ+B;AAY1B,cAAA,KAZ0B,0BAY1B,KAZ0B;AAYnB,cAAA,MAZmB,0BAYnB,MAZmB;AAyBvC,cAAA,YAAY,CAAC;AAAE,gBAAA,GAAG,EAAH,GAAF;AAAO,gBAAA,KAAK,EAAL,KAAP;AAAc,gBAAA,MAAM,EAAN;AAAd,eAAD,CAAZ;AACA,cAAA,aAAa,CAAC,KAAD,CAAb;;AA1BuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAA,EAAxB;AAAA,GAAjB;;AA6BA,MAAM,OAAO,GAAG,SAAV,OAAU,GAAK;AAEnB,IAAA,YAAY,CAAC,iBAAD,CAAZ;AACA,IAAA,cAAc,CAAC,kBAAD,CAAd;AACD,GAJD;;AAMA,MAAM,MAAM,GAAG,SAAT,MAAS,CAAC,SAAD,EAA4B;AACzC,QAAM,YAAY,GAAG,cAAA,CAAA,QAAA,CAAS,EAAT,KAAgB,KAAhB,GAAwB,CAAxB,GAA4B,CAAC,CAAlD;AACA,QAAI,QAAQ,GAAG,QAAQ,GAAG,KAAK,YAAL,IAAqB,SAAS,KAAK,IAAd,GAAqB,CAArB,GAAyB,CAAC,CAA/C,CAA1B;;AAEA,QAAI,QAAQ,GAAG,GAAf,EAAoB;AAClB,MAAA,QAAQ,GAAG,CAAC,EAAZ;AACD,KAFD,MAEO,IAAI,QAAQ,GAAG,CAAC,GAAhB,EAAqB;AAC1B,MAAA,QAAQ,GAAG,EAAX;AACD;;AACD,IAAA,WAAW,CAAC,QAAD,CAAX;AACD,GAVD;;AAYA,SACE,oBAAC,cAAD,CAAC,IAAD;AAAM,IAAA,KAAK,EAAE,MAAM,CAAC,SAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,cAAD,CAAC,IAAD;AAAM,IAAA,KAAK,EAAE,CAAC,MAAM,CAAC,GAAR,EAAa;AAAE,MAAA,iBAAiB,EAAE;AAArB,KAAb,CAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,YAAD,CAAC,UAAD;AACE,IAAA,MAAM,EAAC,aADT;AAEE,IAAA,IAAI,EAAC,YAFP;AAGE,IAAA,OAAO,EAAE;AAAA,aAAM,MAAM,CAAC,KAAD,CAAZ;AAAA,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAME,oBAAC,YAAD,CAAC,UAAD;AACE,IAAA,MAAM,EAAC,cADT;AAEE,IAAA,IAAI,EAAC,YAFP;AAGE,IAAA,OAAO,EAAE;AAAA,aAAM,MAAM,CAAC,IAAD,CAAZ;AAAA,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANF,CADF,EAaE,oBAAC,cAAD,CAAC,IAAD;AAAM,IAAA,KAAK,EAAE,MAAM,CAAC,GAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,YAAD,CAAC,UAAD;AAAY,IAAA,MAAM,EAAC,OAAnB;AAA2B,IAAA,IAAI,EAAC,QAAhC;AAAyC,IAAA,OAAO,EAAE;AAAA,aAAM,OAAO,EAAb;AAAA,KAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE,oBAAC,cAAD,CAAC,IAAD;AAAM,IAAA,KAAK,EAAE,MAAM,CAAC,MAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAFF,EAGE,oBAAC,YAAD,CAAC,UAAD;AACE,IAAA,MAAM,EAAC,OADT;AAEE,IAAA,IAAI,EAAC,MAFP;AAGE,IAAA,OAAO,EAAE;AAAA,aAAM,cAAc,CAAC,kBAAD,CAApB;AAAA,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,CAbF,CADF;AAyBD;;AA1FD,OAAA,CAAA,MAAA,GAAA,MAAA;AA4FA,IAAM,MAAM,GAAG,cAAA,CAAA,UAAA,CAAW,MAAX,CAAkB;AAC/B,EAAA,SAAS,EAAE;AACT,IAAA,IAAI,EAAE,CADG;AAET,IAAA,aAAa,EAAE,QAFN;AAGT,IAAA,cAAc,EAAE,eAHP;AAIT,IAAA,UAAU,EAAE;AAJH,GADoB;AAO/B,EAAA,MAAM,EAAE;AACN,IAAA,KAAK,EAAE,MADD;AAEN,IAAA,QAAQ,EAAE,EAFJ;AAGN,IAAA,SAAS,EAAE;AAHL,GAPuB;AAY/B,EAAA,GAAG,EAAE;AACH,IAAA,KAAK,EAAE,MADJ;AAEH,IAAA,MAAM,EAAE,EAFL;AAGH,IAAA,aAAa,EAAE,KAHZ;AAIH,IAAA,cAAc,EAAE,eAJb;AAKH,IAAA,UAAU,EAAE,QALT;AAMH,IAAA,iBAAiB,EAAE;AANhB;AAZ0B,CAAlB,CAAf","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Rotate = void 0;\nconst React = __importStar(require(\"react\"));\nconst react_native_1 = require(\"react-native\");\nconst recoil_1 = require(\"recoil\");\nconst IconButton_1 = require(\"../components/IconButton\");\nconst Store_1 = require(\"../Store\");\nconst ImageManipulator = __importStar(require(\"expo-image-manipulator\"));\nfunction Rotate() {\n    //\n    const [, setProcessing] = recoil_1.useRecoilState(Store_1.processingState);\n    const [imageData, setImageData] = recoil_1.useRecoilState(Store_1.imageDataState);\n    const [, setEditingMode] = recoil_1.useRecoilState(Store_1.editingModeState);\n    const [originalImageData] = React.useState(imageData);\n    const [rotation, setRotation] = React.useState(0);\n    React.useEffect(() => {\n        if (rotation !== 0) {\n            onRotate(rotation);\n        }\n        else {\n            setImageData(originalImageData);\n        }\n    }, [rotation]);\n    const onRotate = (angle) => __awaiter(this, void 0, void 0, function* () {\n        setProcessing(true);\n        // Rotate the image by the specified angle\n        // To get rid of thing white line caused by context its being painted onto\n        // crop 1 px border off https://github.com/expo/expo/issues/7325\n        const { uri: rotateUri, width: rotateWidth, height: rotateHeight, } = yield ImageManipulator.manipulateAsync(originalImageData.uri, [\n            { rotate: angle },\n        ]);\n        const { uri, width, height } = yield ImageManipulator.manipulateAsync(rotateUri, [\n            {\n                crop: {\n                    originX: 1,\n                    originY: 1,\n                    width: rotateWidth - 2,\n                    height: rotateHeight - 2,\n                },\n            },\n        ]);\n        setImageData({ uri, width, height });\n        setProcessing(false);\n    });\n    const onClose = () => {\n        // If closing reset the image back to its original\n        setImageData(originalImageData);\n        setEditingMode(\"operation-select\");\n    };\n    const rotate = (direction) => {\n        const webDirection = react_native_1.Platform.OS === \"web\" ? 1 : -1;\n        let rotateBy = rotation - 90 * webDirection * (direction === \"cw\" ? 1 : -1);\n        // keep it in the -180 to 180 range\n        if (rotateBy > 180) {\n            rotateBy = -90;\n        }\n        else if (rotateBy < -180) {\n            rotateBy = 90;\n        }\n        setRotation(rotateBy);\n    };\n    return (<react_native_1.View style={styles.container}>\n      <react_native_1.View style={[styles.row, { paddingHorizontal: \"20%\" }]}>\n        <IconButton_1.IconButton iconID=\"rotate-left\" text=\"Rotate -90\" onPress={() => rotate(\"ccw\")}/>\n        <IconButton_1.IconButton iconID=\"rotate-right\" text=\"Rotate +90\" onPress={() => rotate(\"cw\")}/>\n      </react_native_1.View>\n      <react_native_1.View style={styles.row}>\n        <IconButton_1.IconButton iconID=\"close\" text=\"Cancel\" onPress={() => onClose()}/>\n        <react_native_1.Text style={styles.prompt}>Rotate</react_native_1.Text>\n        <IconButton_1.IconButton iconID=\"check\" text=\"Done\" onPress={() => setEditingMode(\"operation-select\")}/>\n      </react_native_1.View>\n    </react_native_1.View>);\n}\nexports.Rotate = Rotate;\nconst styles = react_native_1.StyleSheet.create({\n    container: {\n        flex: 1,\n        flexDirection: \"column\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n    },\n    prompt: {\n        color: \"#fff\",\n        fontSize: 21,\n        textAlign: \"center\",\n    },\n    row: {\n        width: \"100%\",\n        height: 80,\n        flexDirection: \"row\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        paddingHorizontal: \"2%\",\n    },\n});\n//# sourceMappingURL=Rotate.js.map"]},"metadata":{},"sourceType":"script"}